{{- define "funds" -}}
  <mj-table>
    <tr>
      <th width="140px">ISIN</th>
      <th>Libellé</th>
      <th width="80px">Score</th>
    </tr>

    {{- range $index, $fund := . -}}
      <tr {{- if odd $index }} style="background-color: #e1e1e8"{{- end -}}>
        <td align="center">
          <a href="https://funds.vibioh.fr/?isin={{ $fund.isin }}" rel="noopener noreferrer" target="_blank">{{- $fund.isin -}}</a>
        </td>
        <td>{{- $fund.label -}}</td>
        <td align="center">{{ $fund.score }}</td>
      </tr>
    {{- end -}}
  </mj-table>
{{- end -}}

<mjml>
  <mj-body background-color="#e1e1e8">
    <mj-section background-color="#3a3a3a">
      <mj-column>
        <mj-text align="center" color="#f8f8f8" padding="0" font-size="24px" font-weight="bold">Funds</mj-text>
      </mj-column>
    </mj-section>

    <mj-section background-color="#ffffff">
      <mj-column>
        <mj-text>Bonjour,</mj-text>

        {{- if len .aboveFunds -}}
          <mj-text color="#4cae4c">Les fonds suivants viennent de dépasser le score de <strong>{{- .score -}}</strong>.</mj-text>
          {{- template "funds" .aboveFunds -}}
        {{- end -}}

        {{- if len .belowFunds -}}
          <mj-text color="#d43f3a">Les fonds suivants viennent de repasser sous leur seuil initial d'alerte.</mj-text>
          {{ template "funds" .belowFunds -}}
        {{- end -}}

        <mj-text>Pour plus d'informations, n'hésitez pas à consulter <a href="https://funds.vibioh.fr/?o=score" rel="noopener noreferrer" target="_blank">notre site</a></mj-text>

        <mj-text>
            Bonne journée,
            <br />
            A bientôt,
        </mj-text>
      </mj-column>
    </mj-section>

    {{- template "footer" -}}
  </mj-body>
</mjml>
